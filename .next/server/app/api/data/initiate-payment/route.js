(()=>{var t={};t.id=9,t.ids=[9],t.modules={3524:t=>{"use strict";t.exports=require("@prisma/client")},517:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9491:t=>{"use strict";t.exports=require("assert")},6113:t=>{"use strict";t.exports=require("crypto")},2361:t=>{"use strict";t.exports=require("events")},7147:t=>{"use strict";t.exports=require("fs")},3685:t=>{"use strict";t.exports=require("http")},5158:t=>{"use strict";t.exports=require("http2")},5687:t=>{"use strict";t.exports=require("https")},1017:t=>{"use strict";t.exports=require("path")},2781:t=>{"use strict";t.exports=require("stream")},6224:t=>{"use strict";t.exports=require("tty")},7310:t=>{"use strict";t.exports=require("url")},3837:t=>{"use strict";t.exports=require("util")},9796:t=>{"use strict";t.exports=require("zlib")},7529:()=>{},258:(t,e,r)=>{"use strict";r.r(e),r.d(e,{headerHooks:()=>g,originalPathname:()=>x,patchFetch:()=>P,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>y,staticGenerationBailout:()=>w});var a={};r.r(a),r.d(a,{POST:()=>d,dynamic:()=>l});var n=r(5419),s=r(9108),i=r(9678),o=r(8070),u=r(3214),c=r(8428),p=r(8272);let l="force-dynamic";async function d(t){try{let{planId:e,phone:r}=await t.json();if(!process.env.FLUTTERWAVE_SECRET_KEY)return o.Z.json({error:"Server configuration error: Missing API Key"},{status:500});let a=await u._.dataPlan.findUnique({where:{id:e}});if(!a)return o.Z.json({error:"Plan not found"},{status:404});let n=`SAUKI-DATA-${Date.now()}-${Math.floor(1e3*Math.random())}`,s=a.price;console.log(`[Data Init] Charges Flow for ${r}`);let i={tx_ref:n,amount:s.toString(),email:"saukidatalinks@gmail.com",phone_number:r,currency:"NGN",narration:`Data: ${a.network} ${a.data}`,is_permanent:!1};try{let t=(await c.Z.post("https://api.flutterwave.com/v3/charges?type=bank_transfer",i,{headers:{Authorization:`Bearer ${process.env.FLUTTERWAVE_SECRET_KEY}`,"Content-Type":"application/json"}})).data;if("success"!==t.status)throw console.error("[Flutterwave Error]",t),Error(t.message||"Payment initialization failed");let a=t.meta||t.data?.meta,l=a?.authorization;if(!l||!l.transfer_bank||!l.transfer_account)throw console.error("[Flutterwave Error] Missing bank details:",JSON.stringify(t,null,2)),Error("Payment gateway did not return bank account details. Please try again or contact support.");return await u._.transaction.create({data:{tx_ref:n,type:"data",status:"pending",phone:r,amount:s,planId:e,idempotencyKey:(0,p.Z)(),paymentData:t}}),o.Z.json({tx_ref:n,bank:l.transfer_bank,account_number:l.transfer_account,account_name:"SAUKI MART FLW",amount:s,note:l.transfer_note})}catch(e){let t=e.response?.data?.message||e.message;return console.error("[Flutterwave API Exception]",t),o.Z.json({error:"Payment Gateway Error",details:t},{status:502})}}catch(t){return console.error("Data Payment Init Error:",t),o.Z.json({error:t.message||"Payment initiation failed"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/data/initiate-payment/route",pathname:"/api/data/initiate-payment",filename:"route",bundlePath:"app/api/data/initiate-payment/route"},resolvedPagePath:"/workspaces/APP-Final/app/api/data/initiate-payment/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:h,headerHooks:g,staticGenerationBailout:w}=m,x="/api/data/initiate-payment/route";function P(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:y})}},3214:(t,e,r)=>{"use strict";r.d(e,{_:()=>n});var a=r(3524);let n=globalThis.prisma||new a.PrismaClient({log:["query","error","warn"]})},8272:(t,e,r)=>{"use strict";r.d(e,{Z:()=>c});var a=r(6113),n=r.n(a);let s={randomUUID:n().randomUUID},i=new Uint8Array(256),o=i.length,u=[];for(let t=0;t<256;++t)u.push((t+256).toString(16).slice(1));let c=function(t,e,r){if(s.randomUUID&&!e&&!t)return s.randomUUID();let a=(t=t||{}).random||(t.rng||function(){return o>i.length-16&&(n().randomFillSync(i),o=0),i.slice(o,o+=16)})();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e){r=r||0;for(let t=0;t<16;++t)e[r+t]=a[t];return e}return function(t,e=0){return u[t[e+0]]+u[t[e+1]]+u[t[e+2]]+u[t[e+3]]+"-"+u[t[e+4]]+u[t[e+5]]+"-"+u[t[e+6]]+u[t[e+7]]+"-"+u[t[e+8]]+u[t[e+9]]+"-"+u[t[e+10]]+u[t[e+11]]+u[t[e+12]]+u[t[e+13]]+u[t[e+14]]+u[t[e+15]]}(a)}}};var e=require("../../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),a=e.X(0,[638,206,901,428],()=>r(258));module.exports=a})();