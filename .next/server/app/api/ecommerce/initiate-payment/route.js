(()=>{var e={};e.id=108,e.ids=[108],e.modules={3524:e=>{"use strict";e.exports=require("@prisma/client")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5158:e=>{"use strict";e.exports=require("http2")},5687:e=>{"use strict";e.exports=require("https")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},7529:()=>{},1839:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>_,patchFetch:()=>w,requestAsyncStorage:()=>f,routeModule:()=>d,serverHooks:()=>y,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>x});var a={};r.r(a),r.d(a,{POST:()=>l,dynamic:()=>m});var n=r(5419),i=r(9108),s=r(9678),o=r(8070),u=r(3214),c=r(8428),p=r(8272);let m="force-dynamic";async function l(e){try{let{productId:t,phone:r,name:a,state:n,simId:i}=await e.json();if(!process.env.FLUTTERWAVE_SECRET_KEY)return o.Z.json({error:"Server configuration error"},{status:500});let s=await u._.product.findUnique({where:{id:t}});if(!s)return o.Z.json({error:"Product not found"},{status:404});let m=s.price,l=[{name:s.name,price:s.price}],d=[s.name];if(i){let e=await u._.product.findUnique({where:{id:i}});e&&(m+=e.price,l.push({name:e.name,price:e.price}),d.push(e.name))}let f=d.join(" + "),h=`SAUKI-COM-${Date.now()}-${Math.floor(1e3*Math.random())}`,y={tx_ref:h,amount:String(m),email:"saukidatalinks@gmail.com",phone_number:r,currency:"NGN",fullname:a,narration:`SAUKI ${f.substring(0,20)}`,is_permanent:!1,meta:{consumer_id:r,consumer_mac:"kgh94"}};try{let e=(await c.Z.post("https://api.flutterwave.com/v3/charges?type=bank_transfer",y,{headers:{Authorization:`Bearer ${process.env.FLUTTERWAVE_SECRET_KEY}`,"Content-Type":"application/json"}})).data;if("success"!==e.status)throw console.error("FLW Error:",e),Error(e.message||"Payment initialization failed");let i=e.meta||e.data?.meta,s=i?.authorization;if(!s||!s.transfer_bank||!s.transfer_account)throw Error("Gateway returned incomplete bank details.");return await u._.transaction.create({data:{tx_ref:h,type:"ecommerce",status:"pending",phone:r,amount:m,productId:t,customerName:a,deliveryState:n,idempotencyKey:(0,p.Z)(),paymentData:e,deliveryData:{manifest:f,items:l,address:n,initiatedAt:new Date().toISOString()}}}),o.Z.json({tx_ref:h,bank:s.transfer_bank,account_number:s.transfer_account,account_name:"SAUKI MART FLW",amount:m,note:s.transfer_note})}catch(t){console.error("Axios/Gateway Error:",t.response?.data||t.message);let e=t.response?.data?.message||t.message;return o.Z.json({error:"Gateway Error",details:e},{status:502})}}catch(e){return console.error("Internal Error:",e),o.Z.json({error:e.message||"Initiation failed"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/ecommerce/initiate-payment/route",pathname:"/api/ecommerce/initiate-payment",filename:"route",bundlePath:"app/api/ecommerce/initiate-payment/route"},resolvedPagePath:"/workspaces/APP-Final/app/api/ecommerce/initiate-payment/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:y,headerHooks:g,staticGenerationBailout:x}=d,_="/api/ecommerce/initiate-payment/route";function w(){return(0,s.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:h})}},3214:(e,t,r)=>{"use strict";r.d(t,{_:()=>n});var a=r(3524);let n=globalThis.prisma||new a.PrismaClient({log:["query","error","warn"]})},8272:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var a=r(6113),n=r.n(a);let i={randomUUID:n().randomUUID},s=new Uint8Array(256),o=s.length,u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));let c=function(e,t,r){if(i.randomUUID&&!t&&!e)return i.randomUUID();let a=(e=e||{}).random||(e.rng||function(){return o>s.length-16&&(n().randomFillSync(s),o=0),s.slice(o,o+=16)})();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=a[e];return t}return function(e,t=0){return u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]}(a)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,206,428],()=>r(1839));module.exports=a})();