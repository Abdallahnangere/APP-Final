(()=>{var e={};e.id=916,e.ids=[916],e.modules={3524:e=>{"use strict";e.exports=require("@prisma/client")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5158:e=>{"use strict";e.exports=require("http2")},5687:e=>{"use strict";e.exports=require("https")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},7529:()=>{},5697:(e,r,t)=>{"use strict";t.r(r),t.d(r,{headerHooks:()=>f,originalPathname:()=>x,patchFetch:()=>_,requestAsyncStorage:()=>d,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>w});var a={};t.r(a),t.d(a,{POST:()=>p});var s=t(5419),n=t(9108),i=t(9678),o=t(8070),u=t(3214),c=t(8428),l=t(8272);async function p(e){try{let{firstName:r,lastName:t,phone:a,pin:s}=await e.json();if(!r||!t||!a||!s)return o.Z.json({error:"All fields are required"},{status:400});if(await u._.agent.findUnique({where:{phone:a}}))return o.Z.json({error:"Agent with this phone number already exists"},{status:400});let n=`AGENT-REG-${(0,l.Z)()}`,i=`agent.${a}@www.saukimart.online`,p=process.env.MY_BVN;if(!process.env.FLUTTERWAVE_SECRET_KEY||!p)return o.Z.json({error:"Server misconfiguration: Missing Keys"},{status:500});let m={account_number:"",bank_name:"",account_name:""};try{let e=await c.Z.post("https://api.flutterwave.com/v3/virtual-account-numbers",{email:i,is_permanent:!0,bvn:p,tx_ref:n,phonenumber:a,firstname:r,lastname:`${t} Sauki Mart FLW`,narration:`Sauki Agent ${r}`},{headers:{Authorization:`Bearer ${process.env.FLUTTERWAVE_SECRET_KEY}`,"Content-Type":"application/json"}});if("success"===e.data.status)m={account_number:e.data.data.account_number,bank_name:e.data.data.bank_name,account_name:`${r} ${t} Sauki Mart FLW`};else throw Error(e.data.message)}catch(e){return console.error("FLW Account Creation Failed:",e.response?.data||e.message),o.Z.json({error:"Failed to provision banking wallet. Please try again later."},{status:502})}let d=await u._.agent.create({data:{firstName:r,lastName:t,phone:a,pin:s,flwAccountNumber:m.account_number,flwBankName:m.bank_name,flwAccountName:m.account_name,balance:0}});return o.Z.json({success:!0,agent:d})}catch(e){return console.error("Agent Reg Error:",e),o.Z.json({error:"Registration failed"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/agent/register/route",pathname:"/api/agent/register",filename:"route",bundlePath:"app/api/agent/register/route"},resolvedPagePath:"/workspaces/APP-Final/app/api/agent/register/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:g,serverHooks:h,headerHooks:f,staticGenerationBailout:w}=m,x="/api/agent/register/route";function _(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},3214:(e,r,t)=>{"use strict";t.d(r,{_:()=>s});var a=t(3524);let s=globalThis.prisma||new a.PrismaClient({log:["query","error","warn"]})},8272:(e,r,t)=>{"use strict";t.d(r,{Z:()=>c});var a=t(6113),s=t.n(a);let n={randomUUID:s().randomUUID},i=new Uint8Array(256),o=i.length,u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));let c=function(e,r,t){if(n.randomUUID&&!r&&!e)return n.randomUUID();let a=(e=e||{}).random||(e.rng||function(){return o>i.length-16&&(s().randomFillSync(i),o=0),i.slice(o,o+=16)})();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,r){t=t||0;for(let e=0;e<16;++e)r[t+e]=a[e];return r}return function(e,r=0){return u[e[r+0]]+u[e[r+1]]+u[e[r+2]]+u[e[r+3]]+"-"+u[e[r+4]]+u[e[r+5]]+"-"+u[e[r+6]]+u[e[r+7]]+"-"+u[e[r+8]]+u[e[r+9]]+"-"+u[e[r+10]]+u[e[r+11]]+u[e[r+12]]+u[e[r+13]]+u[e[r+14]]+u[e[r+15]]}(a)}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[638,206,428],()=>t(5697));module.exports=a})();