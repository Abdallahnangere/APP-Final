"use strict";(()=>{var e={};e.id=9009,e.ids=[9009],e.modules={3524:e=>{e.exports=require("@prisma/client")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9491:e=>{e.exports=require("assert")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5158:e=>{e.exports=require("http2")},5687:e=>{e.exports=require("https")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},6224:e=>{e.exports=require("tty")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},258:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>w,patchFetch:()=>q,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>y,staticGenerationBailout:()=>x});var a={};r.r(a),r.d(a,{POST:()=>d,dynamic:()=>c});var n=r(5419),o=r(9108),i=r(9678),s=r(8070),u=r(3214),p=r(8428),l=r(8272);let c="force-dynamic";async function d(e){try{let{planId:t,phone:r}=await e.json();if(!process.env.FLUTTERWAVE_SECRET_KEY)return s.Z.json({error:"Server configuration error: Missing API Key"},{status:500});let a=await u._.dataPlan.findUnique({where:{id:t}});if(!a)return s.Z.json({error:"Plan not found"},{status:404});let n=`SAUKI-DATA-${Date.now()}-${Math.floor(1e3*Math.random())}`,o=a.price;console.log(`[Data Init] Charges Flow for ${r}`);let i={tx_ref:n,amount:o.toString(),email:"saukidatalinks@gmail.com",phone_number:r,currency:"NGN",narration:`Data: ${a.network} ${a.data}`,is_permanent:!1};try{let e=(await p.Z.post("https://api.flutterwave.com/v3/charges?type=bank_transfer",i,{headers:{Authorization:`Bearer ${process.env.FLUTTERWAVE_SECRET_KEY}`,"Content-Type":"application/json"}})).data;if("success"!==e.status)throw console.error("[Flutterwave Error]",e),Error(e.message||"Payment initialization failed");let a=e.meta||e.data?.meta,c=a?.authorization;if(!c||!c.transfer_bank||!c.transfer_account)throw console.error("[Flutterwave Error] Missing bank details:",JSON.stringify(e,null,2)),Error("Payment gateway did not return bank account details. Please try again or contact support.");return await u._.transaction.create({data:{tx_ref:n,type:"data",status:"pending",phone:r,amount:o,planId:t,idempotencyKey:(0,l.Z)(),paymentData:e}}),s.Z.json({tx_ref:n,bank:c.transfer_bank,account_number:c.transfer_account,account_name:"SAUKI MART FLW",amount:o,note:c.transfer_note})}catch(t){let e=t.response?.data?.message||t.message;return console.error("[Flutterwave API Exception]",e),s.Z.json({error:"Payment Gateway Error",details:e},{status:502})}}catch(e){return console.error("Data Payment Init Error:",e),s.Z.json({error:e.message||"Payment initiation failed"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/data/initiate-payment/route",pathname:"/api/data/initiate-payment",filename:"route",bundlePath:"app/api/data/initiate-payment/route"},resolvedPagePath:"/workspaces/APP-Final/app/api/data/initiate-payment/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:h,headerHooks:g,staticGenerationBailout:x}=m,w="/api/data/initiate-payment/route";function q(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:y})}},3214:(e,t,r)=>{r.d(t,{_:()=>n});var a=r(3524);let n=globalThis.prisma||new a.PrismaClient({log:["query","error","warn"]})},8272:(e,t,r)=>{r.d(t,{Z:()=>p});var a=r(6113),n=r.n(a);let o={randomUUID:n().randomUUID},i=new Uint8Array(256),s=i.length,u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));let p=function(e,t,r){if(o.randomUUID&&!t&&!e)return o.randomUUID();let a=(e=e||{}).random||(e.rng||function(){return s>i.length-16&&(n().randomFillSync(i),s=0),i.slice(s,s+=16)})();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=a[e];return t}return function(e,t=0){return u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]}(a)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206,7901,8428],()=>r(258));module.exports=a})();