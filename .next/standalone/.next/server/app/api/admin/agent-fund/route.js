"use strict";(()=>{var e={};e.id=6513,e.ids=[6513],e.modules={3524:e=>{e.exports=require("@prisma/client")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},8633:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>v,patchFetch:()=>w,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>h});var n={};r.r(n),r.d(n,{POST:()=>l});var a=r(5419),i=r(9108),o=r(9678),s=r(8070),u=r(3214),d=r(8272);async function l(e){try{let{agentId:t,amount:r,password:n,action:a}=await e.json();if(n!==process.env.ADMIN_PASSWORD)return s.Z.json({error:"Unauthorized"},{status:401});if("toggle_status"===a){let e=await u._.agent.findUnique({where:{id:t}});if(!e)return s.Z.json({error:"Not found"},{status:404});return await u._.agent.update({where:{id:t},data:{isActive:!e.isActive}}),s.Z.json({success:!0})}if("credit"===a||"debit"===a){let e="debit"===a;if(e){let e=await u._.agent.findUnique({where:{id:t}});if(!e||e.balance<r)return s.Z.json({error:"Insufficient funds for debit"},{status:400})}return await u._.$transaction([u._.agent.update({where:{id:t},data:{balance:e?{decrement:r}:{increment:r}}}),u._.transaction.create({data:{tx_ref:`ADMIN-${a.toUpperCase()}-${(0,d.Z)()}`,type:"wallet_funding",status:"delivered",phone:"ADMIN",amount:e?-r:r,agentId:t,deliveryData:{method:`Admin Manual ${a.toUpperCase()}`}}})]),s.Z.json({success:!0})}return s.Z.json({error:"Invalid Action"},{status:400})}catch(e){return s.Z.json({error:"Server Error"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/agent-fund/route",pathname:"/api/admin/agent-fund",filename:"route",bundlePath:"app/api/admin/agent-fund/route"},resolvedPagePath:"/workspaces/APP-Final/app/api/admin/agent-fund/route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:f,serverHooks:m,headerHooks:g,staticGenerationBailout:h}=c,v="/api/admin/agent-fund/route";function w(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:f})}},3214:(e,t,r)=>{r.d(t,{_:()=>a});var n=r(3524);let a=globalThis.prisma||new n.PrismaClient({log:["query","error","warn"]})},8272:(e,t,r)=>{r.d(t,{Z:()=>d});var n=r(6113),a=r.n(n);let i={randomUUID:a().randomUUID},o=new Uint8Array(256),s=o.length,u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));let d=function(e,t,r){if(i.randomUUID&&!t&&!e)return i.randomUUID();let n=(e=e||{}).random||(e.rng||function(){return s>o.length-16&&(a().randomFillSync(o),s=0),o.slice(s,s+=16)})();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]}(n)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[1638,6206],()=>r(8633));module.exports=n})();