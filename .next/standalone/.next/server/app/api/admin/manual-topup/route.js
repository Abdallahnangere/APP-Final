(()=>{var e={};e.id=186,e.ids=[186],e.modules={3524:e=>{"use strict";e.exports=require("@prisma/client")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5158:e=>{"use strict";e.exports=require("http2")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},7529:()=>{},5860:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>h,originalPathname:()=>x,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>A,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>f});var s={};r.r(s),r.d(s,{POST:()=>c});var a=r(5419),n=r(9108),o=r(9678),i=r(8070),u=r(3214),l=r(8272),p=r(2760);async function c(e){try{let{phone:t,planId:r,password:s}=await e.json();if(s!==process.env.ADMIN_PASSWORD)return i.Z.json({error:"Unauthorized"},{status:401});let a=await u._.dataPlan.findUnique({where:{id:r}});if(!a)return i.Z.json({error:"Plan not found"},{status:404});let n=p.Vi[a.network],o=`MANUAL-${(0,l.Z)()}`,c={network:n,mobile_number:t,plan:Number(a.planId),Ported_number:!0};console.log("[Manual Topup] Sending to Amigo:",JSON.stringify(c));let d=await (0,p.Ft)("/data/",c,o),m=d.success&&(!0===d.data.success||"successful"===d.data.Status||"delivered"===d.data.status||"successful"===d.data.status),g=await u._.transaction.create({data:{tx_ref:o,type:"data",status:m?"delivered":"failed",phone:t,amount:0,planId:a.id,deliveryData:d.data,paymentData:{method:"Manual Admin Topup"}}});if(!m)return i.Z.json({error:"Tunnel Delivery Failed",details:d.data},{status:400});return i.Z.json({success:!0,transaction:g})}catch(e){return console.error(e),i.Z.json({error:e.message||"Server Error"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/manual-topup/route",pathname:"/api/admin/manual-topup",filename:"route",bundlePath:"app/api/admin/manual-topup/route"},resolvedPagePath:"/workspaces/APP-Final/app/api/admin/manual-topup/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:A,headerHooks:h,staticGenerationBailout:f}=d,x="/api/admin/manual-topup/route";function y(){return(0,o.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:g})}},2760:(e,t,r)=>{"use strict";let s;r.d(t,{Ft:()=>p,Vi:()=>c});var a=r(8428),n=r(6489);let o=process.env.AMIGO_BASE_URL||"https://amigo.ng/api/data/",i=process.env.AWS_PROXY_URL,u=process.env.AMIGO_API_KEY||"";if(i)try{s=new n.HttpsProxyAgent(i)}catch(e){console.error("Failed to initialize Proxy Agent",e)}let l=a.Z.create({httpsAgent:s,proxy:!1,headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`,Token:u,"X-API-Key":u,Accept:"application/json"},timeout:6e4});async function p(e,t,r){console.log(`[Amigo Tunnel] ðŸš€ Requesting: ${o}`),console.log(`[Amigo Tunnel] ðŸ“¦ Payload:`,JSON.stringify(t));try{let e={};r&&(e["Idempotency-Key"]=r);let s=await l.post(o,t,{headers:e});return console.log(`[Amigo Tunnel] âœ… Success: ${s.status}`),{success:!0,data:s.data,status:s.status}}catch(t){let e=t.response?.data?.message||t.message;return console.error(`[Amigo Tunnel] âŒ Failed: ${e}`),{success:!1,data:t.response?.data||{error:e},status:t.response?.status||500}}}let c={MTN:1,GLO:2,AIRTEL:4,"9MOBILE":9}},3214:(e,t,r)=>{"use strict";r.d(t,{_:()=>a});var s=r(3524);let a=globalThis.prisma||new s.PrismaClient({log:["query","error","warn"]})},8272:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var s=r(6113),a=r.n(s);let n={randomUUID:a().randomUUID},o=new Uint8Array(256),i=o.length,u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));let l=function(e,t,r){if(n.randomUUID&&!t&&!e)return n.randomUUID();let s=(e=e||{}).random||(e.rng||function(){return i>o.length-16&&(a().randomFillSync(o),i=0),o.slice(i,i+=16)})();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=s[e];return t}return function(e,t=0){return u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]}(s)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,206,901,428,489],()=>r(5860));module.exports=s})();